# æ”¯ä»˜å®æ»‘å—éªŒè¯ç å®Œæ•´æŠ€æœ¯æ–‡æ¡£

> åŒ…å«Hookå®ç°ã€é…ç½®è¯¦è§£ã€åŸç†åˆ†æçš„ä¸€ç«™å¼æ–‡æ¡£

**è¯´æ˜**: æœ¬æ–‡æ¡£é’ˆå¯¹æ”¯ä»˜å®çš„æ»‘å—éªŒè¯ç ï¼ˆCaptchaï¼‰æœºåˆ¶ï¼Œæä¾›å®Œæ•´çš„æŠ€æœ¯åˆ†æå’Œå…³é—­æ–¹æ¡ˆã€‚

---

## ğŸ“‹ ç›®å½•

- [ä¸€ã€æ¦‚è¿°](#ä¸€æ¦‚è¿°)
- [äºŒã€Hookå®ç°](#äºŒhookå®ç°)
- [ä¸‰ã€é…ç½®å‚æ•°è¯¦è§£](#ä¸‰é…ç½®å‚æ•°è¯¦è§£)
- [å››ã€æŠ€æœ¯åŸç†åˆ†æ](#å››æŠ€æœ¯åŸç†åˆ†æ)
- [äº”ã€å®æˆ˜æŒ‡å—](#äº”å®æˆ˜æŒ‡å—)
- [å…­ã€æ•…éšœæ’æŸ¥](#å…­æ•…éšœæ’æŸ¥)

---

## ä¸€ã€æ¦‚è¿°

### 1.1 åŠŸèƒ½è¯´æ˜

æœ¬æ–‡æ¡£æä¾›äº†å®Œæ•´çš„æ”¯ä»˜å®æ»‘å—éªŒè¯ç å…³é—­è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ï¼š
- âœ… ç®€æ´é«˜æ•ˆçš„Hookå®ç°ä»£ç 
- âœ… è¯¦ç»†çš„é…ç½®å‚æ•°è¯´æ˜
- âœ… å®Œæ•´çš„æŠ€æœ¯åŸç†åˆ†æ
- âœ… å®æˆ˜ä½¿ç”¨æŒ‡å—

**éªŒè¯ç ç±»å‹**: æ»‘å—éªŒè¯ç ï¼ˆSlide Captchaï¼‰

### 1.2 å®ç°åŸç†

é€šè¿‡Hook `GlobalCache.e()` æ–¹æ³•ï¼Œåœ¨é…ç½®åˆå§‹åŒ–æ—¶ä¿®æ”¹æ»‘å—éªŒè¯ç å¼€å…³é…ç½®ï¼Œå°† `enable` å‚æ•°è®¾ç½®ä¸º `0`ï¼Œä»æºå¤´å…³é—­æ»‘å—éªŒè¯åŠŸèƒ½ã€‚

**ä¼˜åŠ¿**ï¼š
- ğŸ¯ ä»æºå¤´æ§åˆ¶ï¼Œæœ€ç¨³å®šå¯é 
- ğŸ”§ å…¼å®¹æ€§å¥½ï¼Œä¸å—æ”¯ä»˜å®ç‰ˆæœ¬å½±å“
- âœ¨ ä»£ç ç®€æ´ï¼Œæ˜“äºç»´æŠ¤

---

## äºŒã€Hookå®ç°

### 2.1 æ ¸å¿ƒä»£ç 

**æ–‡ä»¶**: `app/src/main/java/fansirsqi/xposed/sesame/hook/CaptchaHook.kt`

```kotlin
package fansirsqi.xposed.sesame.hook

import de.robv.android.xposed.XC_MethodHook
import de.robv.android.xposed.XposedHelpers
import fansirsqi.xposed.sesame.util.Log

/**
 * æ”¯ä»˜å®éªŒè¯ç Hookå·¥å…·ç±»
 * 
 * åŠŸèƒ½è¯´æ˜ï¼š
 * Hook GlobalCache.e() - åœ¨é…ç½®åˆå§‹åŒ–æ—¶ä¿®æ”¹é»˜è®¤å€¼ï¼Œä»æºå¤´å…³é—­éªŒè¯ç 
 * 
 * ä¼˜ç‚¹ï¼š
 * - ä»æºå¤´æ§åˆ¶ï¼Œæœ€ç¨³å®šå¯é 
 * - å…¼å®¹æ€§å¥½ï¼Œä¸å—æ”¯ä»˜å®ç‰ˆæœ¬å½±å“
 * - åç»­æ‰€æœ‰è¯»å–éƒ½æ˜¯ä¿®æ”¹åçš„å€¼
 * 
 * @author ghostxx
 * @since 2025-10-22
 */
object CaptchaHook {
    private const val TAG = "CaptchaHook"

    /**
     * éªŒè¯ç é…ç½®é”®å
     */
    private const val CAPTCHA_SWITCH_KEY = "rds_captcha_switch"
    
    /**
     * é…ç½®åˆ†ç»„å
     */
    private const val CAPTCHA_GROUP_KEY = "switch"

    /**
     * å…³é—­çŠ¶æ€çš„é…ç½®å€¼ï¼ˆenable=0è¡¨ç¤ºå®Œå…¨ç¦ç”¨ï¼‰
     */
    private const val CAPTCHA_DISABLED_CONFIG = """{"enable":0,"intercept":0,"blackList":[],"intervalTime":0}"""

    /**
     * GlobalCacheç±»å
     */
    private const val CLASS_GLOBAL_CACHE = "com.alipay.apmobilesecuritysdk.tool.store.cache.GlobalCache"

    /**
     * ä¸»å…¥å£ï¼šå¯åŠ¨éªŒè¯ç Hook
     * 
     * @param classLoader ç›®æ ‡åº”ç”¨çš„ClassLoader
     */
    fun hookCaptcha(classLoader: ClassLoader) {
        Log.runtime(TAG, "å¼€å§‹Hookæ”¯ä»˜å®éªŒè¯ç ...")
        
        // Hooké…ç½®å†™å…¥ï¼ˆåœ¨åˆå§‹åŒ–æ—¶å°±ä¿®æ”¹é»˜è®¤å€¼ï¼‰
        hookGlobalCacheWrite(classLoader)
        
        Log.runtime(TAG, "éªŒè¯ç Hookè®¾ç½®å®Œæˆ âœ…")
    }

    /**
     * Hookæ–¹æ³•: æ‹¦æˆªGlobalCacheé…ç½®å†™å…¥
     * 
     * åŸç†ï¼šåœ¨åº”ç”¨å¯åŠ¨åˆå§‹åŒ–é…ç½®æ—¶ï¼Œä¿®æ”¹å†™å…¥çš„é»˜è®¤å€¼
     * ä¼˜ç‚¹ï¼šä»æºå¤´æ§åˆ¶ï¼Œåç»­æ‰€æœ‰è¯»å–éƒ½æ˜¯ä¿®æ”¹åçš„å€¼
     * 
     * ç›®æ ‡æ–¹æ³•: GlobalCache.e(String, String, String) -> boolean
     * å‚æ•°è¯´æ˜:
     *   - å‚æ•°1: é…ç½®åˆ†ç»„ (å¦‚ "switch")
     *   - å‚æ•°2: é…ç½®é”®å (å¦‚ "rds_captcha_switch")
     *   - å‚æ•°3: é…ç½®å€¼ (JSONå­—ç¬¦ä¸²)
     *   - è¿”å›å€¼: true=å†™å…¥æˆåŠŸ, false=å†™å…¥å¤±è´¥
     */
    private fun hookGlobalCacheWrite(classLoader: ClassLoader) {
        try {
            val globalCacheClass = XposedHelpers.findClass(CLASS_GLOBAL_CACHE, classLoader)
            
            XposedHelpers.findAndHookMethod(
                globalCacheClass,
                "e",
                String::class.java,
                String::class.java,
                String::class.java,
                object : XC_MethodHook() {
                    override fun beforeHookedMethod(param: MethodHookParam) {
                        val group = param.args[0] as? String
                        val key = param.args[1] as? String
                        val value = param.args[2] as? String
                        
                        // åªæ‹¦æˆªéªŒè¯ç é…ç½®çš„å†™å…¥
                        if (group == CAPTCHA_GROUP_KEY && key == CAPTCHA_SWITCH_KEY) {
                            Log.runtime(TAG, "æ‹¦æˆªéªŒè¯ç é…ç½®å†™å…¥")
                            Log.runtime(TAG, "  é…ç½®åˆ†ç»„: $group")
                            Log.runtime(TAG, "  é…ç½®é”®å: $key")
                            Log.runtime(TAG, "  åŸå§‹é…ç½®: $value")
                            Log.runtime(TAG, "  ä¿®æ”¹é…ç½®: $CAPTCHA_DISABLED_CONFIG")
                            
                            // ä¿®æ”¹å‚æ•°3ï¼Œå°†é…ç½®å€¼æ”¹ä¸ºå…³é—­çŠ¶æ€
                            param.args[2] = CAPTCHA_DISABLED_CONFIG
                        }
                    }
                }
            )
            
            Log.runtime(TAG, "âœ… Hook GlobalCache.e() æˆåŠŸ - å·²æ‹¦æˆªé…ç½®å†™å…¥")
        } catch (e: Throwable) {
            Log.error(TAG, "âŒ Hook GlobalCache.e() å¤±è´¥")
            Log.printStackTrace(TAG, e)
        }
    }
}
```

### 2.2 é›†æˆæ–¹å¼

åœ¨ `ApplicationHook.java` çš„ `handleHookLogic()` æ–¹æ³•å¼€å¤´è°ƒç”¨ï¼š

```java
// HookéªŒè¯ç å…³é—­åŠŸèƒ½ï¼ˆéœ€è¦åœ¨åº”ç”¨åˆå§‹åŒ–ä¹‹å‰å°±Hooké…ç½®å†™å…¥ï¼‰
try {
    CaptchaHook.INSTANCE.hookCaptcha(classLoader);
    Log.runtime(TAG, "éªŒè¯ç Hookå·²å¯ç”¨");
} catch (Throwable t) {
    Log.runtime(TAG, "éªŒè¯ç Hookå¯ç”¨å¤±è´¥");
    Log.printStackTrace(TAG, t);
}
```

**é›†æˆä½ç½®**: `ApplicationHook.java` ç¬¬261-268è¡Œ

### 2.3 æ—¥å¿—è¾“å‡º

**å¯åŠ¨æ—¶æ—¥å¿—**ï¼š
```
[CaptchaHook] å¼€å§‹Hookæ”¯ä»˜å®éªŒè¯ç ...
[CaptchaHook] âœ… Hook GlobalCache.e() æˆåŠŸ - å·²æ‹¦æˆªé…ç½®å†™å…¥
[CaptchaHook] éªŒè¯ç Hookè®¾ç½®å®Œæˆ âœ…
[ApplicationHook] éªŒè¯ç Hookå·²å¯ç”¨
```

**é…ç½®å†™å…¥æ—¶æ—¥å¿—**ï¼š
```
[CaptchaHook] æ‹¦æˆªéªŒè¯ç é…ç½®å†™å…¥
[CaptchaHook]   é…ç½®åˆ†ç»„: switch
[CaptchaHook]   é…ç½®é”®å: rds_captcha_switch
[CaptchaHook]   åŸå§‹é…ç½®: {"enable":2,"intercept":0,"blackList":[],"intervalTime":0}
[CaptchaHook]   ä¿®æ”¹é…ç½®: {"enable":0,"intercept":0,"blackList":[],"intervalTime":0}
```

---

## ä¸‰ã€é…ç½®å‚æ•°è¯¦è§£

### 3.1 é…ç½®JSONç»“æ„

```json
{
  "enable": 2,
  "intercept": 0,
  "blackList": [],
  "intervalTime": 0
}
```

### 3.2 å‚æ•°è¯´æ˜

#### 3.2.1 enableï¼ˆæ€»å¼€å…³ï¼‰

| å€¼ | å«ä¹‰ | è¡Œä¸º |
|----|------|------|
| `0` | âœ… **å®Œå…¨å…³é—­** | ä¸è§¦å‘ä»»ä½•éªŒè¯ç  |
| `1` | é»˜è®¤å¯ç”¨ | æ ¹æ®å…¶ä»–æ¡ä»¶åˆ¤æ–­ |
| `2` | é»‘åå•æ¨¡å¼ | åªå¯¹é»‘åå•ä¸­çš„æ“ä½œè§¦å‘éªŒè¯ç  |

**æºç é€»è¾‘**ï¼š
```java
int i = jSONObject.has("enable") ? jSONObject.getInt("enable") : 1;
if (i == 0) {
    MLog.f("rds_captcha", "degrade: enable = 0");
    return false;  // å®Œå…¨å…³é—­ï¼Œç›´æ¥è¿”å›ä¸è§¦å‘
}
```

#### 3.2.2 interceptï¼ˆæ‹¦æˆªæ¨¡å¼ï¼‰

**ä½œç”¨**ï¼šåŒºåˆ†éªŒè¯ç çš„è§¦å‘æ¥æº

| å€¼ | åŒ¹é…æ¥æº | è¯´æ˜ |
|----|---------|------|
| `0` | `COSTOMS` | è‡ªå®šä¹‰æ¥æºï¼ˆå¸¸è§„RPCè°ƒç”¨ï¼‰ |
| `1` | `INTERCEPT` | æ‹¦æˆªå™¨æ¥æºï¼ˆè¢«æ‹¦æˆªçš„RPCï¼‰ |

**InterceptSourceEnum æšä¸¾**ï¼š
```java
public enum InterceptSourceEnum {
    DEFAULT("default", "rpc"),
    COSTOMS("customs", "rpc"),      // intercept=0 åŒ¹é…
    INTERCEPT("intercept", "rpc"),  // intercept=1 åŒ¹é…
    TinyAppCloud("tinyAppCloud", "rpc"),
    MANUAL("manual", "rpc");
}
```

**æºç é€»è¾‘**ï¼š
```java
int i2 = jSONObject.has("intercept") ? jSONObject.getInt("intercept") : 0;

// æ¥æºä¸åŒ¹é…æ—¶ä¸è§¦å‘
if ((InterceptSourceEnum.INTERCEPT.equals(interceptSourceEnum) && i2 != 1) || 
    (InterceptSourceEnum.COSTOMS.equals(interceptSourceEnum) && i2 != 0)) {
    MLog.f("rds_captcha", "degrade RpcInterceptorSource");
    return false;
}
```

#### 3.2.3 blackListï¼ˆé»‘åå•åˆ—è¡¨ï¼‰

**ä½œç”¨**ï¼šæŒ‡å®šå“ªäº›æ“ä½œéœ€è¦è§¦å‘éªŒè¯ç 

**æ•°æ®ç±»å‹**ï¼šå­—ç¬¦ä¸²æ•°ç»„

**ç¤ºä¾‹**ï¼š
```json
{
  "enable": 2,
  "blackList": [
    "alipay.operation.type.example1",
    "alipay.operation.type.example2",
    "alipay.operation.type.example3"
  ]
}
```

**æºç é€»è¾‘**ï¼š
```java
ArrayList arrayList = new ArrayList();
if (jSONObject.has("blackList")) {
    JSONArray jSONArray = jSONObject.getJSONArray("blackList");
    for (int i4 = 0; i4 < jSONArray.length(); i4++) {
        arrayList.add(jSONArray.getString(i4));
    }
}

// enable=2ï¼ˆé»‘åå•æ¨¡å¼ï¼‰æˆ–è€…æ“ä½œåœ¨é»‘åå•ä¸­ï¼Œæ‰è§¦å‘éªŒè¯ç 
if ((i == 2 || arrayList.contains(str)) && 
    System.currentTimeMillis() - this.f > i3) {
    return b(str, interceptSourceEnum.g);
}
```

**å·¥ä½œæ¨¡å¼**ï¼š
- å½“ `enable = 2` æ—¶ï¼š**åªæœ‰åœ¨é»‘åå•ä¸­çš„æ“ä½œæ‰ä¼šè§¦å‘éªŒè¯ç **
- å½“ `enable = 1` æ—¶ï¼šé»‘åå•ä½œä¸ºé¢å¤–æ¡ä»¶

#### 3.2.4 intervalTimeï¼ˆé—´éš”æ—¶é—´ï¼‰

**ä½œç”¨**ï¼šæ§åˆ¶ä¸¤æ¬¡éªŒè¯ç è§¦å‘çš„æœ€å°æ—¶é—´é—´éš”

**å•ä½**ï¼šæ¯«ç§’ï¼ˆmsï¼‰

**ç¤ºä¾‹**ï¼š
```json
{
  "intervalTime": 60000  // 1åˆ†é’Ÿå†…åªè§¦å‘ä¸€æ¬¡
}
```

**æºç é€»è¾‘**ï¼š
```java
int i3 = jSONObject.has("intervalTime") ? jSONObject.getInt("intervalTime") : 0;

// æ£€æŸ¥è·ç¦»ä¸Šæ¬¡è§¦å‘çš„æ—¶é—´é—´éš”
if (System.currentTimeMillis() - this.f > i3) {
    return b(str, interceptSourceEnum.g);
}
```

### 3.3 å®Œæ•´åˆ¤æ–­æµç¨‹

```
1. æ£€æŸ¥é…ç½®æ˜¯å¦ä¸ºç©º
   â†“ æ˜¯ â†’ ä¸è§¦å‘
   â†“ å¦
   
2. æ£€æŸ¥ enable å€¼
   â†“ enable=0 â†’ ä¸è§¦å‘ âœ…
   â†“ enableâ‰ 0
   
3. æ£€æŸ¥æ˜¯å¦å·²åœ¨éªŒè¯ä¸­
   â†“ æ˜¯ â†’ ä¸è§¦å‘
   â†“ å¦
   
4. æ£€æŸ¥ intercept æ¥æº
   â†“ ä¸åŒ¹é… â†’ ä¸è§¦å‘
   â†“ åŒ¹é…
   
5. æ£€æŸ¥æ—¶é—´é—´éš”
   â†“ æœªè¾¾åˆ° â†’ ä¸è§¦å‘
   â†“ å·²è¾¾åˆ°
   
6. æ£€æŸ¥é»‘åå•æ¡ä»¶
   â†“ enable=2 ä¸”ä¸åœ¨é»‘åå• â†’ ä¸è§¦å‘
   â†“ enable=2 ä¸”åœ¨é»‘åå• â†’ è§¦å‘éªŒè¯ç  âš ï¸
```

---

## å››ã€æŠ€æœ¯åŸç†åˆ†æ

### 4.1 æ ¸å¿ƒç±»ç»“æ„

#### 4.1.1 CaptchaManagerï¼ˆéªŒè¯ç®¡ç†å™¨ï¼‰

**ç±»å**: `com.alipay.apmobilesecuritysdk.captcha.CaptchaManager`

**æ ¸å¿ƒæ–¹æ³•**:
```java
public boolean c(String str, InterceptSourceEnum interceptSourceEnum)
```

**ä½œç”¨**: åˆ¤æ–­æ˜¯å¦éœ€è¦è§¦å‘éªŒè¯ç æ‹¦æˆª

**è¿”å›å€¼**:
- `true` - è§¦å‘éªŒè¯
- `false` - ä¸è§¦å‘éªŒè¯

#### 4.1.2 GlobalCacheï¼ˆé…ç½®ç¼“å­˜ï¼‰

**ç±»å**: `com.alipay.apmobilesecuritysdk.tool.store.cache.GlobalCache`

**æ ¸å¿ƒæ–¹æ³•**:
```java
public static boolean e(String str, String str2, String str3)
```

**å‚æ•°**:
- `str` - é…ç½®åˆ†ç»„ï¼ˆå¦‚ "switch"ï¼‰
- `str2` - é…ç½®é”®åï¼ˆå¦‚ "rds_captcha_switch"ï¼‰
- `str3` - é…ç½®å€¼ï¼ˆJSONå­—ç¬¦ä¸²ï¼‰

**è¿”å›å€¼**: `true`=å†™å…¥æˆåŠŸ

**å­˜å‚¨ç»“æ„**:
```java
public static ConcurrentHashMap<String, String> f149052a = new ConcurrentHashMap<>();

// å­˜å‚¨æ ¼å¼
{
  "switch_rds_captcha_switch": "{\"enable\":2,...}",
  ...
}
```

### 4.2 é…ç½®è¯»å–æµç¨‹

```
åº”ç”¨å¯åŠ¨
    â†“
GlobalConfig é™æ€åˆå§‹åŒ– <clinit>
    â†“
GlobalCache.e("switch", "rds_captcha_switch", "...")
    â†“
[æˆ‘ä»¬çš„Hook] ä¿®æ”¹å‚æ•°3 â†’ {"enable":0,...}
    â†“
å†™å…¥ ConcurrentHashMap
    â†“
åç»­æ‰€æœ‰è¯»å–éƒ½æ˜¯ä¿®æ”¹åçš„å€¼
```

### 4.3 éªŒè¯è§¦å‘æµç¨‹

```
ç”¨æˆ·æ‰§è¡Œç‰¹å®šæ“ä½œ
    â†“
RPC æ‹¦æˆªå™¨æ£€æµ‹
    â†“
CaptchaManager.c(operationType, source)
    â†“
è¯»å–é…ç½®: GlobalConfig.b("rds_captcha_switch")
    â†“
ä» GlobalCache è¯»å–ï¼ˆå·²è¢«Hookä¿®æ”¹ï¼‰
    â†“
è§£æ JSON: {"enable":0,...}
    â†“
åˆ¤æ–­ enable å€¼
    â†“
enable=0 â†’ return falseï¼ˆä¸è§¦å‘æ»‘å—éªŒè¯ï¼‰âœ…
```

### 4.4 å…³é”®ç±»å’Œæ–¹æ³•æ±‡æ€»

| ç±» | æ–¹æ³• | ä½œç”¨ |
|-----|------|------|
| `GlobalCache` | `e(String, String, String)` | âœ… **å†™å…¥é…ç½®ï¼ˆHookç›®æ ‡ï¼‰** |
| `GlobalCache` | `b(String, String)` | è¯»å–é…ç½® |
| `GlobalConfig` | `b(String)` | è¯»å–é…ç½®ï¼ˆå°è£…ï¼‰ |
| `CaptchaManager` | `c(String, InterceptSourceEnum)` | åˆ¤æ–­æ˜¯å¦è§¦å‘éªŒè¯ |
| `CaptchaManager` | `b(String, String)` | é”å®šéªŒè¯çŠ¶æ€ |

### 4.5 ç›¸å…³æ–‡ä»¶è·¯å¾„

```
com/alipay/apmobilesecuritysdk/
â”œâ”€â”€ captcha/
â”‚   â”œâ”€â”€ CaptchaManager.java              âœ… éªŒè¯ç®¡ç†å™¨
â”‚   â”œâ”€â”€ CaptchaNativeVerifyRpcManager.java  RPC ç®¡ç†å™¨
â”‚   â””â”€â”€ rpc/
â”‚       â”œâ”€â”€ AntCaptchaNativeVerifyService.java
â”‚       â””â”€â”€ model/
â”‚           â”œâ”€â”€ CaptchaVerifyRequest.java
â”‚           â””â”€â”€ AntCaptchaVerifyResult.java
â””â”€â”€ tool/
    â”œâ”€â”€ config/
    â”‚   â””â”€â”€ GlobalConfig.java            é…ç½®ç®¡ç†
    â””â”€â”€ store/cache/
        â””â”€â”€ GlobalCache.java              âœ… é…ç½®ç¼“å­˜ï¼ˆHookç›®æ ‡ï¼‰
```

---

## äº”ã€å®æˆ˜æŒ‡å—

### 5.1 å¿«é€Ÿå¼€å§‹

1. **ç¼–è¯‘æ¨¡å—**
   ```bash
   ./gradlew assembleCompatibleDebug
   ```

2. **å®‰è£…åˆ°è®¾å¤‡**
   - å®‰è£…ç”Ÿæˆçš„APK
   - åœ¨LSPosedä¸­æ¿€æ´»æ¨¡å—
   - é‡å¯æ”¯ä»˜å®

3. **éªŒè¯æ•ˆæœ**
   - æŸ¥çœ‹æ—¥å¿—ï¼Œç¡®è®¤HookæˆåŠŸ
   - æ‰§è¡Œè½¬è´¦ç­‰æ“ä½œ
   - è§‚å¯Ÿæ˜¯å¦è¿˜ä¼šå¼¹å‡ºéªŒè¯ç 

### 5.2 æ—¥å¿—ç›‘æ§

**æˆåŠŸæ ‡å¿—**ï¼š
```
[CaptchaHook] å¼€å§‹Hookæ”¯ä»˜å®éªŒè¯ç ...
[CaptchaHook] âœ… Hook GlobalCache.e() æˆåŠŸ - å·²æ‹¦æˆªé…ç½®å†™å…¥
[CaptchaHook] éªŒè¯ç Hookè®¾ç½®å®Œæˆ âœ…
```

**æ‹¦æˆªæ ‡å¿—**ï¼š
```
[CaptchaHook] æ‹¦æˆªéªŒè¯ç é…ç½®å†™å…¥
[CaptchaHook]   åŸå§‹é…ç½®: {"enable":2,...}
[CaptchaHook]   ä¿®æ”¹é…ç½®: {"enable":0,...}
```

### 5.3 éªŒè¯æ–¹æ³•

1. **æŸ¥çœ‹æ—¥å¿—**ï¼šè§‚å¯Ÿæ˜¯å¦æœ‰æ‹¦æˆªä¿¡æ¯
2. **å®é™…æµ‹è¯•**ï¼šæ‰§è¡Œè½¬è´¦æ“ä½œï¼Œç¡®è®¤ä¸ä¼šå¼¹å‡ºéªŒè¯ç 
3. **é•¿æœŸè§‚å¯Ÿ**ï¼šæŒç»­ä½¿ç”¨ï¼Œç¡®ä¿ç¨³å®šæ€§

---

## å…­ã€æ•…éšœæ’æŸ¥

### 6.1 å¸¸è§é—®é¢˜

#### Q1: Hookå¤±è´¥ï¼Œæ—¥å¿—æ˜¾ç¤ºæ‰¾ä¸åˆ°ç±»

**åŸå› **: æ”¯ä»˜å®ç‰ˆæœ¬æ›´æ–°ï¼Œç±»åå¯èƒ½å˜åŒ–

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨JADXåç¼–è¯‘æ–°ç‰ˆæœ¬APK
2. æœç´¢ `GlobalCache` ç±»
3. ç¡®è®¤ç±»åå’Œæ–¹æ³•ç­¾å
4. æ›´æ–°Hookä»£ç 

#### Q2: HookæˆåŠŸä½†ä»ç„¶å‡ºç°éªŒè¯ç 

**åŸå› **: å¯èƒ½æ˜¯æœåŠ¡ç«¯åŠ¨æ€ä¸‹å‘é…ç½®è¦†ç›–äº†æœ¬åœ°é…ç½®

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥æ—¥å¿—ï¼Œç¡®è®¤æ˜¯å¦æˆåŠŸæ‹¦æˆªé…ç½®å†™å…¥
2. è€ƒè™‘Hooké…ç½®è¯»å–æ–¹æ³• `GlobalConfig.b()`
3. æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–åˆå§‹åŒ–è·¯å¾„

#### Q3: æ—¥å¿—æ˜¾ç¤ºHookæˆåŠŸï¼Œä½†æ²¡æœ‰æ‹¦æˆªæ—¥å¿—

**åŸå› **: é…ç½®å†™å…¥å¯èƒ½åœ¨Hookä¹‹å‰å®Œæˆ

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤Hookæ—¶æœºæ˜¯å¦è¶³å¤Ÿæ—©ï¼ˆåº”åœ¨ `Application.attach` ä¹‹å‰ï¼‰
2. æ£€æŸ¥ `ApplicationHook.java` ä¸­çš„è°ƒç”¨ä½ç½®

### 6.2 è°ƒè¯•æŠ€å·§

1. **å¢åŠ æ—¥å¿—**ï¼šåœ¨å…³é”®ä½ç½®æ·»åŠ æ›´å¤šæ—¥å¿—è¾“å‡º
2. **æ–­ç‚¹è°ƒè¯•**ï¼šä½¿ç”¨IDEAè¿œç¨‹è°ƒè¯•åŠŸèƒ½
3. **ç‰ˆæœ¬å¯¹æ¯”**ï¼šå¯¹æ¯”ä¸åŒæ”¯ä»˜å®ç‰ˆæœ¬çš„å·®å¼‚

### 6.3 ç‰ˆæœ¬å…¼å®¹æ€§

| æ”¯ä»˜å®ç‰ˆæœ¬ | HookçŠ¶æ€ | è¯´æ˜ |
|-----------|---------|------|
| 10.3.x - 10.5.x | âœ… å·²æµ‹è¯• | å®Œå…¨å…¼å®¹ |
| 10.6.x+ | âš ï¸ å¾…æµ‹è¯• | éœ€è¦éªŒè¯ç±»åæ˜¯å¦å˜åŒ– |

**å»ºè®®**: æ¯æ¬¡æ”¯ä»˜å®æ›´æ–°åï¼Œå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯Hookæ˜¯å¦æœ‰æ•ˆ

---

## ä¸ƒã€æ€»ç»“

### 7.1 æ ¸å¿ƒè¦ç‚¹

1. **Hookç›®æ ‡**: `GlobalCache.e()` æ–¹æ³•
2. **Hookæ—¶æœº**: åº”ç”¨å¯åŠ¨åˆå§‹åŒ–æ—¶
3. **å…³é”®é…ç½®**: è®¾ç½® `enable=0`
4. **æ•ˆæœ**: ä»æºå¤´å…³é—­éªŒè¯ç åŠŸèƒ½

### 7.2 ä¼˜åŠ¿

- âœ… **ç¨³å®šå¯é **: ä»æºå¤´æ§åˆ¶ï¼Œåç»­æ‰€æœ‰è¯»å–éƒ½æ˜¯ä¿®æ”¹åçš„å€¼
- âœ… **å…¼å®¹æ€§å¥½**: `GlobalCache` ç±»éå¸¸ç¨³å®šï¼Œä¸å—ç‰ˆæœ¬å½±å“
- âœ… **ä»£ç ç®€æ´**: åªéœ€Hookä¸€ä¸ªæ–¹æ³•ï¼Œæ˜“äºç»´æŠ¤
- âœ… **æ€§èƒ½ä¼˜ç§€**: æ— éœ€å¤šå±‚æ‹¦æˆªï¼Œå¼€é”€æœ€å°

### 7.3 æœ€ä½³å®è·µ

1. âœ… åœ¨ `Application.attach` ä¹‹å‰å°±å®ŒæˆHook
2. âœ… è¯¦ç»†è®°å½•æ—¥å¿—ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥
3. âœ… æ¯æ¬¡æ”¯ä»˜å®æ›´æ–°åéªŒè¯å…¼å®¹æ€§
4. âœ… å®šæœŸæŸ¥çœ‹æ—¥å¿—ï¼Œç¡®ä¿HookæŒç»­ç”Ÿæ•ˆ

---

## é™„å½•

### A. ç›¸å…³é“¾æ¥

- **é¡¹ç›®åœ°å€**: [Sesame-TK](https://github.com/fansirsqi/Sesame-TK)
- **åˆ†æå·¥å…·**: JADX + jadx-mcp-server

### B. ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | è¯´æ˜ |
|-----|------|------|
| v1.0 | 2025-10-22 | åˆå§‹ç‰ˆæœ¬ |

### C. è´¡çŒ®è€…

- **ä½œè€…**: ghostxx
- **åˆ†æ**: JADX + MCPå·¥å…·
- **æµ‹è¯•**: Sesame-TK å›¢é˜Ÿ

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-10-22  
**æ–‡æ¡£ç±»å‹**: æŠ€æœ¯æ–‡æ¡£ + å®æˆ˜æŒ‡å—

